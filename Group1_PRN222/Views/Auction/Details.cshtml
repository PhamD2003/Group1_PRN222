@model Product
@{
    var bids = ViewBag.Bids as List<Bid>;
    var currentPrice = bids?.FirstOrDefault()?.Amount ?? Model.StartPrice;
}

<div class="container mt-5">
    <div class="card shadow p-4">
        <div class="text-center mb-4">
            <img src="@Model.Images" alt="Ảnh sản phẩm" class="img-fluid rounded" style="max-height: 300px;" />
        </div>
        @if (TempData["Error"] != null)
        {
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                <strong>⚠️ Lỗi:</strong> @TempData["Error"]
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Đóng"></button>
            </div>
        }
        <h2 class="text-primary fw-bold mb-2">@Model.Title</h2>
        <p class="text-muted mb-3">@Model.Description</p>
        <p>🕒 <strong>Thời gian kết thúc:</strong> @Model.AuctionEndTime?.ToString("dd/MM/yyyy HH:mm")</p>

        <hr />

        <div class="mb-4">
            <h4 class="text-success">💰 Giá hiện tại: <span class="fw-bold">@currentPrice?.ToString("N0") VNĐ</span></h4>
        </div>

        <form method="post" action="/Auction/Bid" class="row g-3 align-items-center mb-4">
            <input type="hidden" name="productId" value="@Model.Id" />
            <div class="col-auto">
                <label for="amount" class="col-form-label fw-semibold">Giá bạn muốn đặt (VNĐ):</label>
            </div>
            <div class="col-auto">
                <input type="number" name="amount" class="form-control" step="1" min="0"/>
            </div>
            <div class="col-auto">
                <button type="submit" class="btn btn-warning text-white fw-bold">⚔️ Đặt giá</button>
            </div>
        </form>

        <hr />

        <h5 class="fw-bold mb-3">📜 Lịch sử đấu giá</h5>
        @if (bids != null && bids.Count > 0)
        {
            <div class="list-group">
                @foreach (var b in bids)
                {
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <strong class="text-danger">@b.Amount?.ToString("N0") VNĐ</strong>
                            bởi người dùng ID: <strong>@b.BidderId</strong>
                        </div>
                        <small class="text-muted">@b.BidTime?.ToString("dd/MM/yyyy HH:mm:ss")</small>
                    </div>
                }
            </div>
        }
        else
        {
            <p class="text-muted fst-italic">Chưa có ai đặt giá.</p>
        }

        <div class="mt-4">
            <a href="/Product" class="btn btn-outline-secondary">← Quay lại danh sách sản phẩm</a>
        </div>
    </div>
</div>
